<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trombinoscope avec D3.js</title>
    <style>
        /* Styles pour personnaliser le trombinoscope */
        #trombinoscope {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .participant {
            border: 2px solid #333;
            padding: 20px;
            text-align: center;
            background-color: #c0c0c0;
            border-radius: 10px;
            box-shadow: 2px 2px 4px #888888;
            max-width: 300px; /* Ajustez la largeur maximale pour contrôler la taille */
        }

        .participant img {
            max-width: 100%;
            border: 2px solid #333;
            border-radius: 50%;
        }

        .participant p {
            font-size: 16px;
            color: #333;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Utilisation des réseaux sociaux</h1> <!-- Titre visible sur la page -->
    <div id="trombinoscope"></div>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script>
        // Lien de votre feuille de calcul Google Sheets
        const googleSheetsUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQKAGwYx8H72GlvZSeHLHiZo612vbYZzmsqbP17_Y2zCzfLeQXEU5phUxuB-NEqTcBIJp8o2Oh9JevX/pub?output=csv";

        // Fonction pour télécharger le contenu des liens
        async function fetchLinkContent(link) {
            try {
                const response = await fetch(link);
                if (response.ok) {
                    return await response.text();
                }
            } catch (error) {
                console.error("Erreur lors du téléchargement du contenu du lien : " + error);
            }
            return "Contenu non disponible";
        }

        // Créer un conteneur pour le trombinoscope
        const trombinoscope = d3.select("#trombinoscope");

        // Charger les données et créer le trombinoscope
        d3.csv(googleSheetsUrl).then(async data => {
            // Créez une div pour chaque participant
            const participants = trombinoscope.selectAll(".participant")
                .data(data)
                .enter()
                .append("div")
                .attr("class", "participant");

            // Téléchargez et affichez le contenu des liens d'image
            participants.append("div")
                .attr("class", "image-container")
                .each(async function (d) {
                    const container = d3.select(this);
                    const link = d.Image;

                    const imageContent = await fetchLinkContent(link);
                    // Utilisez l'URL de l'image directement
                    container.html(`<img src="${imageContent}" alt="Photo">`);
                });

            // Affichez le reste des réponses
            participants.each(function (d) {
                const participant = d3.select(this);
                for (const key in d) {
                    if (key !== "Image") {
                        participant.append("p")
                            .html(`<strong>${key}:</strong> ${d[key]}`);
                    }
                }
            });
        })
        .catch(error => {
            console.error("Une erreur s'est produite : " + error);
        });
    </script>
</body>
</html>
